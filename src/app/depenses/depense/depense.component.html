<main class="nxl-container">
  <div class="nxl-content">
    <div class="pt-4">
      <div class="col-lg-11 bg-white px-3 py-3 rounded rounded-4 m-lg-auto">
        <div class="container-fuild">
          <!-- Navigation des Onglets -->
          <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
              <a
                class="nav-link fw-bold active text-uppercase"
                id="vue-ensemble-tab"
                data-bs-toggle="tab"
                href="#vue-ensemble"
                role="tab"
                aria-controls="vue-ensemble"
                aria-selected="true"
                >Dépenses</a
              >
            </li>
            <li class="nav-item" role="presentation">
              <a
                class="nav-link fw-bold text-uppercase"
                id="historique-tab"
                data-bs-toggle="tab"
                href="#historique"
                role="tab"
                aria-controls="historique"
                aria-selected="false"
                >Categories des Dépenses</a
              >
            </li>
            <!-- <li class="nav-item" role="presentation">
              <a
                class="nav-link fw-bold text-uppercase"
                id="nouvel-onglet-tab"
                data-bs-toggle="tab"
                href="#nouvel-onglet"
                role="tab"
                aria-controls="nouvel-onglet"
                aria-selected="false"
                >Sous categories dépenses</a
              >
            </li> -->
          </ul>

          <!-- Contenu des Onglets -->
          <div class="tab-content" id="myTabContent">
            <!-- Vue d'ensemble -->
            <div
              class="tab-pane fade show active"
              id="vue-ensemble"
              role="tabpanel"
              aria-labelledby="vue-ensemble-tab"
            >
              <div class="py-5 px-3">
                <div class="row">
                  <div class="col-lg-10">
                    <h1 class="rounded rounded-4 text-uppercase py-1">
                      Dépenses
                    </h1>
                  </div>
                  <div class="col-lg-2">
                    <div class="row">
                      <div
                        class="col-lg-12 d-lg-flex justify-content-end align-items-end"
                      >
                        <button
                          style="background-color: #3454d1"
                          type="button"
                          routerLink="/depense/create/0"
                          class="text-uppercase btn text-white"
                        >
                          <i class="fa-solid mx-2 fa-plus"></i> Ajouter une
                          depense
                        </button>
                      </div>
                    </div>
                  </div>
                 
                </div>
                <div>
                  <div class="row">
                    <!-- Dépenses totales -->
                    <div class="col-xxl-3 col-md-3">
                      <div class="card card-body">
                        <div class="d-flex justify-content-between align-items-center">
                          <div class="me-3">
                            <h5 class="fs-4">{{ globalService.formatPrix(totalExpenses) }}</h5>
                            <span class="text-muted">Dépenses totales</span>
                          </div>
                          <div class="avatar-text avatar-lg bg-success text-white rounded">
                            <i class="feather-dollar-sign"></i>
                          </div>
                        </div>
                      </div>
                    </div>
                  
                    <!-- Charges fixes -->
                    <div class="col-xxl-3 col-md-3">
                      <div class="card card-body">
                        <div class="d-flex justify-content-between align-items-center">
                          <div class="me-3">
                            <h5 class="fs-4">{{ globalService.formatPrix(fixedCosts) }}</h5>
                            <span class="text-muted">Charges fixes</span>
                          </div>
                          <div class="avatar-text avatar-lg bg-warning text-white rounded">
                            <i class="feather-tag"></i>
                          </div>
                        </div>
                      </div>
                    </div>
                  
                    <!-- Charges variables -->
                    <div class="col-xxl-3 col-md-3">
                      <div class="card card-body">
                        <div class="d-flex justify-content-between align-items-center">
                          <div class="me-3">
                            <h5 class="fs-4">{{ globalService.formatPrix(variableCosts) }}</h5>
                            <span class="text-muted">Charges variables</span>
                          </div>
                          <div class="avatar-text avatar-lg bg-teal text-white rounded">
                            <i class="feather-bar-chart-2"></i>
                          </div>
                        </div>
                      </div>
                    </div>
                  
                    <!-- Coût d'acquisition -->
                    <div class="col-xxl-3 col-md-3">
                      <div class="card card-body">
                        <div class="d-flex justify-content-between align-items-center">
                          <div class="me-3">
                            <h5 class="fs-4">{{ globalService.formatPrix(cogs) }}</h5>
                            <span class="text-muted">Coût d'acquisition</span>
                          </div>
                          <div class="avatar-text avatar-lg bg-primary text-white rounded">
                            <i class="feather-shopping-cart"></i>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <div class="row">
                    <!-- Filtrer par catégorie -->
                    <div class="col-lg-4">
                      <label for="categorie" class="mt-3">Catégorie</label>
                      <select (change)="onCategorieChange($event)" class="form-control form-select" id="categorie">
                        <option value="">Filtrer par catégorie</option>
                        <option *ngFor="let categorie of Tbcategorie" [value]="categorie.id_categorie">{{categorie.nom_categorie}}</option>
                      </select>
                    </div>
                  
                    <!-- Filtrer par sous-catégorie -->
                    <!-- <div class="col-lg-3">
                      <label for="sous-categorie" class="mt-3">Sous-catégorie</label>
                      <select (change)="onSousCategorieChange($event)" class="form-control form-select" id="sous-categorie">
                        <option value="">Filtrer par sous-catégorie</option>
                        <option *ngFor="let sousCategorie of tbSousCategories" [value]="sousCategorie.id_sous_categorie">{{sousCategorie.nom_sous_categorie}}</option>
                      </select>
                    </div> -->
                  
                    <!-- Filtrer par point de vente -->
                    <div class="col-lg-4">
                      <label for="pointDeVente" class="mt-3">Point de vente</label>
                      <select (change)="onPointDeVenteChange($event)" class="form-control form-select" id="pointDeVente">
                        <option value="">Filtrer par point de vente</option>
                        <option *ngFor="let pointDeVente of tbPointdeVente" [value]="pointDeVente.point_de_vente_id">{{pointDeVente.nom}}</option>
                      </select>
                    </div>
                  
                    <!-- Filtrer par date de début -->
                    <div class="col-lg-2">
                      <label for="dateDebut" class="mt-3">Date de début</label>
                      <input (change)="onDateDebutChange($event)" class="form-control" type="date" id="dateDebut" />
                    </div>
                  
                    <!-- Filtrer par date de fin -->
                    <div class="col-lg-2">
                      <label for="dateFin" class="mt-3">Date de fin</label>
                      <input (change)="onDateFinChange($event)" class="form-control" type="date" id="dateFin" />
                    </div>
                  </div>
                  
                  <div class="mat-elevation-z8 mt-3">
                    <table
                      mat-table
                      [dataSource]="dataSource"
                      style="max-height: 400px; overflow-y: auto"
                      *ngIf="!isloadingpage; else loader"
                    >
                      <!-- Colonne ID Dépense -->
                      <ng-container matColumnDef="id_depense">
                        <th
                          class="bg-color-primary"
                          mat-header-cell
                          *matHeaderCellDef
                        >
                          ID Dépense
                        </th>
                        <td class="pointer" mat-cell *matCellDef="let element">
                          {{ element.id_depense }}
                        </td>
                        <td
                          mat-footer-cell
                          class="bg-table-color text-light"
                          *matFooterCellDef
                        ></td>
                      </ng-container>

                      <!-- Colonne Date et Heure -->
                      <ng-container matColumnDef="date_heure">
                        <th
                          class="bg-color-primary"
                          mat-header-cell
                          *matHeaderCellDef
                        >
                          Date et Heure
                        </th>
                        <td class="pointer" mat-cell *matCellDef="let element">
                          {{ globalService.formatDate(element.date_heure) }}
                        </td>
                        <td
                          mat-footer-cell
                          class="bg-table-color text-light"
                          *matFooterCellDef
                        ></td>
                      </ng-container>

                      <!-- Colonne Catégorie de Dépense -->
                      <ng-container matColumnDef="id_categorie">
                        <th
                          class="bg-color-primary"
                          mat-header-cell
                          *matHeaderCellDef
                        >
                          Catégorie
                        </th>
                        <td class="pointer" mat-cell *matCellDef="let element">
                          {{ getCategorieName(element.id_categorie) }}
                        </td>
                        <td
                          mat-footer-cell
                          class="bg-table-color text-light"
                          *matFooterCellDef
                        ></td>
                      </ng-container>

                      <!-- Colonne Montant -->
                      <ng-container matColumnDef="montant">
                        <th
                          class="bg-color-primary"
                          mat-header-cell
                          *matHeaderCellDef
                        >
                          Montant
                        </th>
                        <td class="pointer" mat-cell *matCellDef="let element">
                          {{ globalService.formatPrix(element.montant) }}
                        </td>
                        <td
                          mat-footer-cell
                          class="bg-table-color text-light"
                          *matFooterCellDef
                        ></td>
                      </ng-container>

                      <!-- Colonne Employé Responsable -->
                      <ng-container matColumnDef="employe_responsable">
                        <th
                          class="bg-color-primary"
                          mat-header-cell
                          *matHeaderCellDef
                        >
                          Responsable
                        </th>
                        <td class="pointer" mat-cell *matCellDef="let element">
                          {{getUserName( element.employe_responsable) }}
                        </td>
                        <td
                          mat-footer-cell
                          class="bg-table-color text-light"
                          *matFooterCellDef
                        ></td>
                      </ng-container>

                      <!-- Colonne Note Additionnelle -->
                      <ng-container matColumnDef="note_additionnelle">
                        <th
                          class="bg-color-primary"
                          mat-header-cell
                          *matHeaderCellDef
                        >
                          Note
                        </th>
                        <td class="pointer" mat-cell *matCellDef="let element">
                          {{ element.note_additionnelle }}
                        </td>
                        <td
                          mat-footer-cell
                          class="bg-table-color text-light"
                          *matFooterCellDef
                        ></td>
                      </ng-container>

                      <!-- Colonne Point de Vente -->
                      <ng-container matColumnDef="point_de_vente_id">
                        <th
                          class="bg-color-primary"
                          mat-header-cell
                          *matHeaderCellDef
                        >
                          Point de Vente
                        </th>
                        <td class="pointer" mat-cell *matCellDef="let element">
                          {{ getPointName(element.point_de_vente_id )}}
                        </td>
                        <td
                          mat-footer-cell
                          class="bg-table-color text-light"
                          *matFooterCellDef
                        ></td>
                      </ng-container>

                      <!-- Colonne Actions -->
                      <ng-container matColumnDef="Actions">
                        <th
                          class="text-center"
                          mat-header-cell
                          *matHeaderCellDef
                        >
                          Actions
                        </th>
                        <td
                          class="text-center"
                          mat-cell
                          *matCellDef="let element"
                        >
                          <button
                            (click)="actions(element)"
                            style="cursor: pointer"
                            class="border border-0 rounded rounded-2 actions"
                          >
                            <i class="fa-solid fa-eye"></i>
                          </button>
                        </td>
                        <td
                          mat-footer-cell
                          class="bg-table-color text-light"
                          *matFooterCellDef
                        ></td>
                      </ng-container>

                      <!-- Header & Row definitions -->
                      <tr
                        mat-header-row
                        *matHeaderRowDef="displayedColumns"
                      ></tr>
                      <tr
                        mat-row
                        *matRowDef="let row; columns: displayedColumns"
                      ></tr>
                    </table>

                    <mat-paginator
                      [pageSizeOptions]="[10, 20, 30]"
                      showFirstLastButtons
                      aria-label="Sélectionner la page des éléments"
                    ></mat-paginator>
                  </div>
                </div>
              </div>
            </div>

            <!-- Historique des Dépenses -->
            <div
              class="tab-pane fade"
              id="historique"
              role="tabpanel"
              aria-labelledby="historique-tab"
            >
     
              <div>
                <app-categorie-depenses></app-categorie-depenses>
              </div>
            </div>
            <!-- <div class="tab-pane fade" id="nouvel-onglet" role="tabpanel" aria-labelledby="nouvel-onglet-tab">
              <app-sous-categorie-depenses></app-sous-categorie-depenses>
            </div> -->
          </div>
        </div>
      </div>

      
    </div>
  </div>
</main>
<ng-template #loader>
  <div class="text-center">
    <app-loader></app-loader>
  </div>
</ng-template>
