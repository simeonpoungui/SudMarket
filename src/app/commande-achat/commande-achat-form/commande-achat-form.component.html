<main class="nxl-container">
  <div class="nxl-content">
    <div class="col-lg-8 m-lg-auto py-3 px-lg-5">
      <div class="row">
        <div class="col-12 mt-2">
          <form
            class="row rounded rounded-4 bg-white p-3 needs-validation"
          >
            <div class="col-lg-4">
              <label for="validationCustom01" class="form-label label"
                >Date commande</label
              >
              <input
                [readonly]="action == 'edit'"
                type="text"
                class="form-control"
                name="date_vente"
                [value]="globalService.formatDate(date_commande)"
              />
            </div>

            <div class="col-lg-4">
              <label for="validationCustom01" class="form-label label"
                >Montant total commande</label
              >
              <input
                [readonly]="action == 'edit'"
                type="text"
                class="form-control"
                name="montant_total"
                [value]="globalService.formatPrix(montant_total)"
              />
            </div>

            <div class="col-lg-4">
              <label for="validationCustom01" class="form-label label"
                >Point de vente</label
              >
              <input
                [readonly]="action == 'edit'"
                type="text"
                class="form-control"
                name="point_de_vente_id"
                [value]="getPointName(point_de_vente_id)"
              />
            </div>

            <div class="col-lg-6 mt-3">
              <label for="validationCustom01" class="form-label label">
                Fournisseur</label
              >
              <input
                type="text"
                [readonly]="action == 'edit'"
                class="form-control"
                name="client_id"
                [value]="getFournisseurName(fournisseur_id)"
              />
            </div>

            <div class="col-lg-6 mt-3">
              <label for="validationCustom01" class="form-label label"
                >Effectuée par :
              </label>
              <input
                [readonly]="action == 'edit'"
                type="text"
                class="form-control"
                name="utilisateur_id"
                [value]="getUserName(utilisateur_id)"
              />
            </div>
            
            <div class="col-lg-6 mt-3">
              <label for="validationCustom01" class="form-label label">Statut livraison</label>
              <select [disabled]="statut == 'livrée' ? true : false" (change)="updateCommandeProduitStock($event)" class="form-control" name="statut" [(ngModel)]="statut">
                <option *ngFor="let statut of statuts" [value]="statut.value">
                  {{ statut.label }}
                </option>
              </select>
            </div>

            <div class="col-lg-6 mt-3">
              <label for="validationCustom01" class="form-label label">Statut de validation</label>
              <select [disabled]="disabelBtnValidate == 'livrée' ? true : false" class="form-control" name="	statut_validation" [(ngModel)]="statut_validation">
                <option *ngFor="let statut of statutsValidation" [value]="statut.value">
                  {{ statut.label }}
                </option>
              </select>
            </div>
            
      <div>
        <div class="col-lg-2 mt-3">
          <button
          *ngIf="!isloadingBtnValidateCommande; else loader"
          [disabled]="disabelBtnValidate == 'livrée' ? true : false"
            (click)="updateCommande()"
            class="form-control bg-primary text-white"
          >
            Valider <i class="fa-solid text-white mx-1 fa-pen"></i>
          </button>
        </div>
      </div>


          </form>
        </div>
        <div class="mt-3 bg-white rounded rounded-4 py-5 px-5">
          <div>
            <h2>Historique des articles commandé</h2>
          </div>
          <div class="mat-elevation-z8">
            <table
              mat-table
              [dataSource]="dataSource"
              style="max-height: 400px; overflow-y: auto"
            >
              <ng-container matColumnDef="produit_id">
                <th class="bg-color-primary" mat-header-cell *matHeaderCellDef>
                  Produit
                </th>
                <td class="pointer" mat-cell *matCellDef="let element">
                  {{ getProduitName(element.produit_id) }}
                </td>
              </ng-container>

              <ng-container matColumnDef="quantite">
                <th class="bg-color-primary" mat-header-cell *matHeaderCellDef>
                  Quantité
                </th>
                <td class="pointer" mat-cell *matCellDef="let element">
                  {{ element.quantite }}
                </td>
              </ng-container>

              <ng-container matColumnDef="prix_unitaire">
                <th class="bg-color-primary" mat-header-cell *matHeaderCellDef>
                  Prix unitaire
                </th>
                <td class="pointer" mat-cell *matCellDef="let element">
                  {{ globalService.formatPrix(element.prix_unitaire) }}
                </td>
              </ng-container>

              <ng-container matColumnDef="prix_total_commande">
                <th class="bg-color-primary" mat-header-cell *matHeaderCellDef>
                  Prix commande
                </th>
                <td class="pointer" mat-cell *matCellDef="let element">
                  {{ globalService.formatPrix(element.prix_total_commande) }}
                </td>
              </ng-container>

              <ng-container matColumnDef="point_de_vente_id">
                <th class="bg-color-primary" mat-header-cell *matHeaderCellDef>
                  Point de vente
                </th>
                <td class="pointer" mat-cell *matCellDef="let element">
                  {{ getPointName(element.point_de_vente_id) }}
                </td>
              </ng-container>

              <ng-container matColumnDef="date_commande">
                <th class="bg-color-primary" mat-header-cell *matHeaderCellDef>
                  Date commande
                </th>
                <td class="pointer" mat-cell *matCellDef="let element">
                  {{globalService.formatDate(element.date_commande) }}
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
            </table>
            <!-- <mat-paginator
              [pageSizeOptions]="[10, 20, 30]"
              showFirstLastButtons
              aria-label="Select page of periodic elements"
            >
            </mat-paginator> -->
          </div>
        </div>
      </div>
    </div>
  </div>
</main>
<ng-template #loader>
  <div class="text-center">
    <app-loader></app-loader>
  </div>
</ng-template>